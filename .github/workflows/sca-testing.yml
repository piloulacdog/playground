# This is a basic workflow to help you get started with Actions

name: SCA testing

# Controls when the workflow will run
on:
  workflow_call:  # Enables this workflow to be called by other workflows
  workflow_dispatch:  # Allows manual triggering
    inputs:
      repo:
        description: 'GitHub repository to scan (e.g., owner/repo)'
        required: true

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  sca-testing:
    name: SCA Testing (${{ inputs.repo }})
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Add input parameter to job summary
        run: |
          echo "## 🔍 SBOM Extraction" >> $GITHUB_STEP_SUMMARY
          echo "**Repository:** \`${{ inputs.repo }}\`" >> $GITHUB_STEP_SUMMARY

      - name: Install Dependencies
        run: ./install_dependencies.sh

      - name: Clone Remote Repository
        run: |
          git clone ${{ inputs.repo }}
          cd $(basename ${{ inputs.repo }})

      - name: Generate SBOMs
        run: ./generate_sboms.sh

      - name: Upload SBOMs using Datadog CI
        run: ./upload_sboms.sh
        
      - name: Save SBOM artifacts
        uses: actions/upload-artifact@v4
        with:
          name: sbom-artifacts
          path: /tmp/sboms

